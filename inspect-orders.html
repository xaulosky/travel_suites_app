<!DOCTYPE html>
<html>

<head>
    <title>YITH Booking Order Inspector</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 10px 0;
        }

        pre {
            background: #f5f5f5;
            padding: 15px;
            overflow-x: auto;
        }

        .error {
            color: red;
        }

        .success {
            color: green;
        }
    </style>
</head>

<body>
    <h1>YITH Booking Order Inspector</h1>

    <div>
        <label>Order ID: <input type="number" id="orderId" value="1" /></label>
        <button onclick="inspectOrder()">Inspect Order</button>
    </div>

    <div>
        <button onclick="listRecentOrders()">List Recent Orders</button>
    </div>

    <h2>Results:</h2>
    <pre id="output">Waiting for action...</pre>

    <script>
        const API_BASE = 'https://travelsuites.cl/wp-json/wc/v3';

        // Estas son las credenciales que ya tienes
        const CONSUMER_KEY = 'ck_17efb8d2c990cff8ad90aabd24e1d3c05a1ab5e8';
        const CONSUMER_SECRET = 'cs_e1fb69c842c541384ee89cc5881ab37d6c876b2b';

        async function inspectOrder() {
            const orderId = document.getElementById('orderId').value;
            const output = document.getElementById('output');
            output.textContent = 'Loading...';

            try {
                const url = `${API_BASE}/orders/${orderId}?consumer_key=${CONSUMER_KEY}&consumer_secret=${CONSUMER_SECRET}`;
                const response = await fetch(url);
                const order = await response.json();

                if (response.ok) {
                    output.className = 'success';
                    output.textContent = '=== ORDER #' + orderId + ' ===\n\n';
                    output.textContent += 'Status: ' + order.status + '\n';
                    output.textContent += 'Date: ' + order.date_created + '\n\n';

                    output.textContent += '=== LINE ITEMS ===\n\n';
                    order.line_items.forEach((item, index) => {
                        output.textContent += `Item ${index + 1}: ${item.name}\n`;
                        output.textContent += `Product ID: ${item.product_id}\n`;
                        output.textContent += `Quantity: ${item.quantity}\n`;
                        output.textContent += `\nMETA DATA:\n`;

                        if (item.meta_data && item.meta_data.length > 0) {
                            item.meta_data.forEach(meta => {
                                output.textContent += `  ${meta.key}: ${JSON.stringify(meta.value)}\n`;
                            });
                        } else {
                            output.textContent += '  (No meta data)\n';
                        }
                        output.textContent += '\n---\n\n';
                    });

                    output.textContent += '\n\n=== FULL JSON ===\n';
                    output.textContent += JSON.stringify(order, null, 2);
                } else {
                    output.className = 'error';
                    output.textContent = 'Error: ' + JSON.stringify(order, null, 2);
                }
            } catch (error) {
                output.className = 'error';
                output.textContent = 'Error: ' + error.message;
            }
        }

        async function listRecentOrders() {
            const output = document.getElementById('output');
            output.textContent = 'Loading recent orders...';

            try {
                const url = `${API_BASE}/orders?consumer_key=${CONSUMER_KEY}&consumer_secret=${CONSUMER_SECRET}&per_page=10&orderby=date&order=desc`;
                const response = await fetch(url);
                const orders = await response.json();

                if (response.ok) {
                    output.className = 'success';
                    output.textContent = '=== RECENT ORDERS ===\n\n';

                    orders.forEach(order => {
                        output.textContent += `Order #${order.id} - ${order.status}\n`;
                        output.textContent += `Date: ${order.date_created}\n`;
                        output.textContent += `Customer: ${order.billing.first_name} ${order.billing.last_name}\n`;
                        output.textContent += `Items: ${order.line_items.length}\n`;

                        // Check if has booking meta
                        const hasBookingMeta = order.line_items.some(item =>
                            item.meta_data && item.meta_data.some(meta =>
                                meta.key.includes('booking') || meta.key.includes('yith')
                            )
                        );
                        output.textContent += `Has Booking Meta: ${hasBookingMeta ? 'YES âœ“' : 'NO'}\n`;
                        output.textContent += '\n---\n\n';
                    });
                } else {
                    output.className = 'error';
                    output.textContent = 'Error: ' + JSON.stringify(orders, null, 2);
                }
            } catch (error) {
                output.className = 'error';
                output.textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>

</html>